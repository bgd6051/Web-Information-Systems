<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Cripton | Información sobre criptoactivos</title>

<!--META-->
<meta name="viewport" content="width=device-width initial-scale=1.0">

<!--FONTS-->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
<link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,400i,600,700" rel="stylesheet">
<link rel="icon" type="image/png" href="../icons/Bitcoin.webp">

<!--CSS-->
<link rel="stylesheet" type="text/css" href="../css/grid.css">
<link rel="stylesheet" type="text/css" href="../style.css">
<link rel="stylesheet" type="text/css" href="../css/menu.css">
<link rel="stylesheet" type="text/css" href="../css/jquery.bxslider.css">
<link rel="stylesheet" type="text/css" href="../css/responsive.css">
<link rel="stylesheet" type="text/css" href="../css/animate.css">
</head>

<body>
<header>
    <div class="container">
        <div class="row">
        <div class="col-lg-12">
            <div class="logo"><a href="../../"><img src="../images/logo.png" alt="cripton"/></a></div>
            <nav class="nav-collapse">
            <ul>                                                                                
                <li class="menu-item"><a href="../../" data-scroll>INICIO</a></li>
                <li class="menu-item"><a href="#poweredByCoingecko" data-scroll>COINGECKO</a></li>
                <li class="menu-item"><a href="../updating/" data-scroll>ACTUALIZAR BBDD</a></li>
                <li class="menu-item"><a href="../listings" data-scroll>LISTADOS</a></li>
                <li class="menu-item"><div class="signup"><a href="../login/">LOG IN</a></div></li>
                <li class="menu-item"><div class="signup"><a href="../register/">SIGN UP</a></div></li>
            </ul>
            </nav>
        </div>
        </div>
    </div>
</header>
<section id="team" style="padding-bottom: 30px">
    <div class="container os-animation">
        <div class="row filaContenedorCentrado">
            <div id="contenedorRegistro" class="col-lg-6 col-sm-6 col-md-3">
                <h2>Información de usuario</h2>
                <form>
                    <label for="nombreUsuario">Nombre de usuario</label>
                    <input id="nombreUsuario" type="text" maxlength="32" value="mi nombre de usuario" disabled>
                </form>
                
                <form id="formulario" action="" style="visibility: hidden; display: none" >
                    <label for="nuevaContrasena">Nueva contraseña</label>
                    <input id="nuevaContrasena" type="password" maxlength="32" required>

                    <label for="repetirContrasena">Repetir contraseña</label>
                    <input id="repetirContrasena" type="password" maxlength="32" required>
                </form>

                <div class="contenedorBotones" >
                    <button onclick="logout()" style="background-color: rgba(214, 2, 2, 0.993); color: white;">Cerrar sesión</button>
                    <button id="cambioContrasena" onclick="mostrarContenidoParaElCambio()">Cambiar contraseña</button>
                </div>
                
                <div id="botonesCambio" class="contenedorBotones" style="visibility: hidden; display: none">
                    <button onclick="limpiarCampos()">Limpiar información</button>
                    <button onclick="editProfile()" style="background-color: rgba(105, 255, 46, 0.993);">Continuar</button>
                </div>
            
            </div>
        </div>
    </div>
        
    </div>
</section>

<div class="client">
    <div class="container">
        <div class="row">
            <div class="col-lg-3 col-sm-6 col-md-3 os-animation" data-os-animation="zoomIn" data-os-animation-delay="0.3s">
                <img src="../images/bitcoin.webp" alt=""/>
            </div>
            <div class="col-lg-3 col-sm-6 col-md-3 os-animation" data-os-animation="zoomIn" data-os-animation-delay="0.5s">
            <img src="../images/ethereum.webp" alt=""/>
            </div>
            <div class="col-lg-3 col-sm-6 col-md-3 os-animation" data-os-animation="zoomIn" data-os-animation-delay="0.7s">
            <img src="../images/xrp.webp" alt=""/>
            </div>
            <div class="col-lg-3 col-sm-6 col-md-3 os-animation" data-os-animation="zoomIn" data-os-animation-delay="0.9s">
            <img src="../images/Tether.webp" alt=""/>
            </div>
        </div>
    </div>
</div>
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-sm-8 col-md-8">
                <div class="row">
                    <div class="col-lg-4 col-sm-4 col-md-4">
                        <article>
                        <h3>Creadores</h3>
                        <a>Bogdan Razvant Sofrone</a>
                        <a>Diego Suárez Etuláin</a>
                        </article>
                    </div>
                    <div class="col-lg-4 col-sm-4 col-md-4">
                        <article>
                        <h3>Grupo</h3>
                        <a>Grupo_70</a>
                        </article>
                    </div>
                    <div class="col-lg-4 col-sm-4 col-md-4">
                        <article>
                        <h3>Asignatura</h3>
                        <a>Sistemas De Información Web</a>
                        </article>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-4 col-sm-4 col-md-4">
                <div class="max350">
                    <h3 id="poweredByCoingecko">
                        <img src="../images/DataPoweredByCoingecko.png" alt="coingecko">
                        <p>Powered By <a href="https://www.coingecko.com/">Coingecko.com</a></p>
                        <p>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - </p>
                        <p>Coingecko demo API <a href="https://docs.coingecko.com/v3.0.1/reference/introduction">docs.coingecko.com</a></p>
                    </h3>
                </div>
            </div>
        </div>
    </div>
</footer>
<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="../js/jquery.bxslider.js"></script>
<script src="../js/fixed-responsive-nav.js"></script> 
<script src="../js/waypoints.min.js"></script>
<script src="../js/script.js"></script> 
<script>
    function mostrarContenidoParaElCambio() {
        let formulario = document.getElementById("formulario");
        let botonesCambio = document.getElementById("botonesCambio");
        let botonCambio = document.getElementById("cambioContrasena");

        formulario.style.display = "";
        formulario.style.visibility = "visible";
        botonesCambio.style.display = "";
        botonesCambio.style.visibility = "visible";

        botonCambio.innerText = "Cancelar";

        botonCambio.onclick = () => {
            formulario.style.display = "none";
            formulario.style.visibility = "hidden";
            botonesCambio.style.display = "none";
            botonesCambio.style.visibility = "hidden";
            botonCambio.innerText = "Cambiar contraseña";

            botonCambio.onclick = mostrarContenidoParaElCambio;
        };
    }

    function limpiarCampos() {
        document.getElementById("nuevaContrasena").value = "";
        document.getElementById("repetirContrasena").value = "";
    }

    function accionFallida(msg) {
        document.getElementById("nuevaContrasena").value = "";
        document.getElementById("repetirContrasena").value = "";
        alert(msg);
    }
    function tieneTexto(text){
        if(text == null){
            return false;
        }
        if(text == ""){
            return false;
        }
        return true;
    }
    function success(redir){
        window.location.href = redir;
        return;
    } 
    function logout() {
        
        var xhr = new XMLHttpRequest();
        var url = "../../src/logout"; //url de AJAX
        console.log("AJAX request: ", url);
        xhr.open("GET", url, true);

        xhr.onload = function(){
            if(xhr.status === 200){
                console.log("AJAX response: ", xhr);
                var response = JSON.parse(xhr.responseText);
                if(response.estado === "exito"){
                    success(response.ruta);
                }else{
                    accionFallida(response.mensaje);
                }
            } else{
                accionFallida(xhr.responseText);
            } 
        };

        xhr.send();
        console.log("AJAX request sent");
    }

    function editProfile() {
        var contrasena = document.getElementById("nuevaContrasena").value;
        var repetirContrasena = document.getElementById("repetirContrasena").value;
        
        if(!tieneTexto(contrasena)){
            accionFallida("rellena el campo nuevaContrasena");
            return;
        }
        if(!tieneTexto(repetirContrasena)){
            accionFallida("rellena el campo repetirContrasena");
            return;
        }
        if(contrasena != repetirContrasena){
            accionFallida("las contraseñas no coinciden");
            return;
        }

        var params = "?NewPassword="+contrasena;
        
        var xhr = new XMLHttpRequest();
        var url = "../../src/profile"+params; //url de AJAX
        console.log("AJAX request: ", url);
        xhr.open("GET", url, true);

        xhr.onload = function(){
            if(xhr.status === 200){
                console.log("AJAX response: ", xhr);
                var response = JSON.parse(xhr.responseText);
                if(response.estado === "exito"){
                    success(response.ruta);
                }else{
                    accionFallida(response.mensaje);
                }
            } else{
                accionFallida(xhr.responseText);
            } 
        };

        xhr.send();
        console.log("AJAX request sent");
    }
</script>
</body>
</html>